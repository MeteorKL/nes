!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define("nesEmulator",[],i):"object"==typeof exports?exports.nesEmulator=i():t.nesEmulator=i()}("undefined"!=typeof self?self:this,function(){return function(t){function i(e){if(s[e])return s[e].exports;var r=s[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}var s={};return i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{configurable:!1,enumerable:!0,get:e})},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="/js/",i(i.s=0)}([function(t,i,s){t.exports={NES:s(1)}},function(t,i,s){var e=s(2),r=s(3),n=s(5),h=s(6),a=function(){this.ines=null,this.mapper=null,this.reset()};a.prototype={reset:function(){this.ines=new e,this.cpu=new r(this),this.ppu=new n(this)},load:function(t){this.ines.load(t),this.setMapper(this.ines.mapperType),this.cpu.load()},step:function(){var t,i=this.cpu.step();for(t=0;t<3*i;t++)this.ppu.step();return i},setMapper:function(t){switch(t){case 0:case 2:this.mapper=new h(this);break;default:throw new Error("unsupported mapper "+t)}}},t.exports=a},function(t,i){var s=function(){this.rpgRom=null,this.chrRom=null,this.sram=new Array(8192);for(var t=0;t<this.sram.length;t++)this.sram[t]=0;this.mapperType=null,this.mirroring=null,this.batteryRam=null};s.prototype={HORIZONTAL_MIRRORING:0,VERTICAL_MIRRORING:1,FOURSCREEN_MIRRORING:2,load:function(t){this.data=t;for(var i=new Array(16),s=0;s<16;s++)i[s]=255&t.charCodeAt(s);if(78!==i[0]||69!==i[1]||83!==i[2]||26!==i[3])throw new Error("Not a valid iNES file.");var e=i[4],r=i[5],n=i[6];this.mirroring=1&n,8&n&&(this.mirroring=this.FOURSCREEN_MIRRORING),this.batteryRam=0!=(2&n);var h=i[7];this.mapperType=240&h|n>>4;for(var s=(i[8],9);s<16;s++)if(0!==i[s])throw new Error("Reserved for future usage and should all be 0.");this.rpgRom=new Array(e);for(var a=16,s=0;s<e;s++){this.rpgRom[s]=new Array(16384);for(var o=0;o<16384&&!(a+o>=t.length);o++)this.rpgRom[s][o]=255&t.charCodeAt(a+o);a+=16384}this.chrRom=new Array(r);for(var s=0;s<r;s++){for(this.chrRom[s]=new Array(4096),o=0;o<4096&&!(a+o>=t.length);o++)this.chrRom[s][o]=255&t.charCodeAt(a+o);a+=4096}}},t.exports=s},function(module,exports,__webpack_require__){const modeAbsolute=1,modeAbsoluteX=2,modeAbsoluteY=3,modeAccumulator=4,modeImmediate=5,modeImplied=6,modeIndexedIndirect=7,modeIndirect=8,modeIndirectIndexed=9,modeRelative=10,modeZeroPage=11,modeZeroPageX=12,modeZeroPageY=13;var instructionModes=[6,7,6,7,11,11,11,11,6,5,4,5,1,1,1,1,10,9,6,9,12,12,12,12,6,3,6,3,2,2,2,2,1,7,6,7,11,11,11,11,6,5,4,5,1,1,1,1,10,9,6,9,12,12,12,12,6,3,6,3,2,2,2,2,6,7,6,7,11,11,11,11,6,5,4,5,1,1,1,1,10,9,6,9,12,12,12,12,6,3,6,3,2,2,2,2,6,7,6,7,11,11,11,11,6,5,4,5,8,1,1,1,10,9,6,9,12,12,12,12,6,3,6,3,2,2,2,2,5,7,5,7,11,11,11,11,6,5,6,5,1,1,1,1,10,9,6,9,12,12,13,13,6,3,6,3,2,2,3,3,5,7,5,7,11,11,11,11,6,5,6,5,1,1,1,1,10,9,6,9,12,12,13,13,6,3,6,3,2,2,3,3,5,7,5,7,11,11,11,11,6,5,6,5,1,1,1,1,10,9,6,9,12,12,12,12,6,3,6,3,2,2,2,2,5,7,5,7,11,11,11,11,6,5,6,5,1,1,1,1,10,9,6,9,12,12,12,12,6,3,6,3,2,2,2,2],instructionSizes=[1,2,0,0,2,2,2,0,1,2,1,0,3,3,3,0,2,2,0,0,2,2,2,0,1,3,1,0,3,3,3,0,3,2,0,0,2,2,2,0,1,2,1,0,3,3,3,0,2,2,0,0,2,2,2,0,1,3,1,0,3,3,3,0,1,2,0,0,2,2,2,0,1,2,1,0,3,3,3,0,2,2,0,0,2,2,2,0,1,3,1,0,3,3,3,0,1,2,0,0,2,2,2,0,1,2,1,0,3,3,3,0,2,2,0,0,2,2,2,0,1,3,1,0,3,3,3,0,2,2,0,0,2,2,2,0,1,0,1,0,3,3,3,0,2,2,0,0,2,2,2,0,1,3,1,0,0,3,0,0,2,2,2,0,2,2,2,0,1,2,1,0,3,3,3,0,2,2,0,0,2,2,2,0,1,3,1,0,3,3,3,0,2,2,0,0,2,2,2,0,1,2,1,0,3,3,3,0,2,2,0,0,2,2,2,0,1,3,1,0,3,3,3,0,2,2,0,0,2,2,2,0,1,2,1,0,3,3,3,0,2,2,0,0,2,2,2,0,1,3,1,0,3,3,3,0],instructioncycles=[7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7],instructionPagecycles=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0,1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,0,0,1,1,0,0],instructionNames=["BRK","ORA","KIL","SLO","NOP","ORA","ASL","SLO","PHP","ORA","ASL","ANC","NOP","ORA","ASL","SLO","BPL","ORA","KIL","SLO","NOP","ORA","ASL","SLO","CLC","ORA","NOP","SLO","NOP","ORA","ASL","SLO","JSR","AND","KIL","RLA","BIT","AND","ROL","RLA","PLP","AND","ROL","ANC","BIT","AND","ROL","RLA","BMI","AND","KIL","RLA","NOP","AND","ROL","RLA","SEC","AND","NOP","RLA","NOP","AND","ROL","RLA","RTI","EOR","KIL","SRE","NOP","EOR","LSR","SRE","PHA","EOR","LSR","ALR","JMP","EOR","LSR","SRE","BVC","EOR","KIL","SRE","NOP","EOR","LSR","SRE","CLI","EOR","NOP","SRE","NOP","EOR","LSR","SRE","RTS","ADC","KIL","RRA","NOP","ADC","ROR","RRA","PLA","ADC","ROR","ARR","JMP","ADC","ROR","RRA","BVS","ADC","KIL","RRA","NOP","ADC","ROR","RRA","SEI","ADC","NOP","RRA","NOP","ADC","ROR","RRA","NOP","STA","NOP","SAX","STY","STA","STX","SAX","DEY","NOP","TXA","XAA","STY","STA","STX","SAX","BCC","STA","KIL","AHX","STY","STA","STX","SAX","TYA","STA","TXS","TAS","SHY","STA","SHX","AHX","LDY","LDA","LDX","LAX","LDY","LDA","LDX","LAX","TAY","LDA","TAX","LAX","LDY","LDA","LDX","LAX","BCS","LDA","KIL","LAX","LDY","LDA","LDX","LAX","CLV","LDA","TSX","LAS","LDY","LDA","LDX","LAX","CPY","CMP","NOP","DCP","CPY","CMP","DEC","DCP","INY","CMP","DEX","AXS","CPY","CMP","DEC","DCP","BNE","CMP","KIL","DCP","NOP","CMP","DEC","DCP","CLD","CMP","NOP","DCP","NOP","CMP","DEC","DCP","CPX","SBC","NOP","ISC","CPX","SBC","INC","ISC","INX","SBC","NOP","SBC","CPX","SBC","INC","ISC","BEQ","SBC","KIL","ISC","NOP","SBC","INC","ISC","SED","SBC","NOP","ISC","NOP","SBC","INC","ISC"];const CPUFrequency=1789773,interruptNone=0,interruptNMI=1,interruptIRQ=2,interruptRESET=3;var CPU=function(t){this.nes=t,this.ram=new Array(2048);for(var i=0;i<this.ram.length;i++)this.ram=0;this.cycles=null,this.stall=null,this.A=0,this.X=0,this.Y=0,this.SP=null,this.N=null,this.V=null,this.U=null,this.B=null,this.D=null,this.I=null,this.Z=null,this.C=null,this.reset()},util=__webpack_require__(4);CPU.prototype={reset:function(){this.SP=253,this.setFlags(36),this.interrupt=interruptNone},load:function(){this.PC=this.read16(65532)},printInstruction:function(){var t=this.read(this.PC),i=instructionSizes[t],s=instructionNames[t],e="  ",r="  ";return i>1&&(e=this.read(this.PC+1).toString(16)),i>2&&(r=this.read(this.PC+2).toString(16)),util.sprintf("%04X  %02s %02s %02s %01s%s %28sA:%02X X:%02X Y:%02X P:%02X SP:%02X CYC:%3d\n",this.PC,t.toString(16),e,r,"NOP"===s&&234!==t?"*":" ",s,"",this.A,this.X,this.Y,this.flags(),this.SP,3*this.cycles%341)},step:function(){if(this.stall>0)return this.stall--,1;var cycles=this.cycles;switch(this.interrupt){case interruptIRQ:this.irq();case interruptNMI:this.nmi()}this.interrupt=interruptNone;var opcode=this.read(this.PC),mode=instructionModes[opcode],address=null,pageCrossed=null;switch(mode){case modeAbsolute:address=this.read16(this.PC+1);break;case modeAbsoluteX:address=this.read16(this.PC+1)+this.X,pageCrossed=this.pagesDiffer(address-this.X,address);break;case modeAbsoluteY:address=this.read16(this.PC+1)+this.Y,pageCrossed=this.pagesDiffer(address-this.Y,address);break;case modeAccumulator:address=0;break;case modeImmediate:address=this.PC+1;break;case modeImplied:address=0;break;case modeIndexedIndirect:address=this.read16bug(this.read(this.PC+1)+this.X&255);break;case modeIndirect:address=this.read16bug(this.read16(this.PC+1));break;case modeIndirectIndexed:address=this.read16bug(this.read(this.PC+1))+this.Y,pageCrossed=this.pagesDiffer(address-this.Y,address);break;case modeRelative:var offset=this.read(this.PC+1);address=offset<128?this.PC+2+offset&65535:this.PC+2+offset-256&65535;break;case modeZeroPage:address=this.read(this.PC+1);break;case modeZeroPageX:address=this.read(this.PC+1)+this.X&255;break;case modeZeroPageY:address=this.read(this.PC+1)+this.Y&255}return this.PC+=instructionSizes[opcode],this.cycles+=instructioncycles[opcode],pageCrossed&&(this.cycles+=instructionPagecycles[opcode]),eval("this."+instructionNames[opcode]+"(address, this.PC, mode)"),this.cycles-cycles},triggerNMI:function(){this.interrupt=interruptNMI},triggerIRQ:function(){0===this.I&&(this.interrupt=interruptIRQ)},nmi:function(){this.push16(this.PC),this.PHP(null),this.PC=this.read16(65530),this.I=1,this.cycles+=7},irq:function(){this.push16(this.PC),this.PHP(null),this.PC=this.read16(65534),this.I=1,this.cycles+=7},RESET:function(){this.push16(this.PC),this.PHP(null),this.PC=this.read16(65532),this.I=1,this.cycles+=7},flags:function(){return this.N<<7|this.V<<6|this.U<<5|this.B<<4|this.D<<3|this.I<<2|this.Z<<1|this.C<<0},setFlags:function(t){this.C=t>>0&1,this.Z=t>>1&1,this.I=t>>2&1,this.D=t>>3&1,this.B=t>>4&1,this.U=t>>5&1,this.V=t>>6&1,this.N=t>>7&1},setZ:function(t){t&=255,this.Z=0===t?1:0},setN:function(t){t&=255,this.N=0!=(128&t)?1:0},setZN:function(t){this.setZ(t),this.setN(t)},pagesDiffer:function(t,i){return(65280&t)!=(65280&i)},read:function(t){if((t&=65535)<8192)return this.ram[t%2048];if(t<16384)return this.nes.ppu.readRegister(8192+(t-8192)%8);if(t<16416)switch(t-16384){case 4014:return this.nes.ppu.readRegister(t);default:throw new Error("unhandled I/O Registers II read at address: "+t.toString(16))}if(t<24576)throw new Error("unhandled Expansion ROM read at address: "+t.toString(16));if(t>=24576)return this.nes.mapper.read(t);throw new Error("unhandled cpu memory read at address: "+t.toString(16))},write:function(t,i){if(t&=65535,i&=255,t<8192)return void(this.ram[t%2048]=i);if(t<16384)return void this.nes.ppu.writeRegister(8192+(t-8192)%8,i);if(t<16416)switch(t-16384){case 4014:return void this.nes.ppu.writeRegister(t,i);default:throw new Error("unhandled I/O Registers II write at address: "+t.toString(16))}if(t<24576)throw new Error("unhandled Expansion ROM write at address: "+t.toString(16));if(t>=24576)return void this.nes.mapper.write(t,i);throw new Error("unhandled cpu memory write at address: "+t.toString(16))},read16:function(t){var i=this.read(t);return(255&this.read(t+1))<<8|255&i},read16bug:function(t){var i=t,s=65280&i|i+1&255,e=this.read(i);return(255&this.read(s))<<8|255&e},push:function(t){this.write(256|this.SP,t),this.SP=this.SP-1&255},pull:function(){return this.SP=this.SP+1&255,this.read(256|this.SP)},push16:function(t){var i=t>>8&255,s=255&t;this.push(i),this.push(s)},pull16:function(){var t=this.pull();return(255&this.pull())<<8|255&t},ADC:function(t,i,s){var e=this.A,r=this.read(t),n=this.C;this.A=e+r+n&255,this.setZN(this.A),this.C=e+r+n>255?1:0,0==(128&(e^r))&&0!=(128&(e^this.A))?this.V=1:this.V=0},AND:function(t,i,s){this.A=this.A&this.read(t),this.setZN(this.A)},ASL:function(t,i,s){if(s===modeAccumulator)this.C=this.A>>7&1,this.A=this.A<<1&255,this.setZN(this.A);else{var e=this.read(t);this.C=e>>7&1,e=e<<1&255,this.write(t,e),this.setZN(e)}},addBranchCycles:function(t,i){this.cycles++,this.pagesDiffer(i,t)&&this.cycles++},BCC:function(t,i,s){0===this.C&&(this.PC=t,this.addBranchCycles(t,i))},BCS:function(t,i,s){0!==this.C&&(this.PC=t,this.addBranchCycles(t,i))},BEQ:function(t,i,s){0!==this.Z&&(this.PC=t,this.addBranchCycles(t,i))},BIT:function(t,i,s){var e=this.read(t);this.V=e>>6&1,this.setZ(e&this.A),this.setN(e)},BMI:function(t,i,s){0!==this.N&&(this.PC=t,this.addBranchCycles(t,i))},BNE:function(t,i,s){0===this.Z&&(this.PC=t,this.addBranchCycles(t,i))},BPL:function(t,i,s){0===this.N&&(this.PC=t,this.addBranchCycles(t,i))},BRK:function(t,i,s){this.push16(this.PC),this.PHP(t,i,s),this.SEI(t,i,s),this.PC=this.read16(65534)},BVC:function(t,i,s){0===this.V&&(this.PC=t,this.addBranchCycles(t,i))},BVS:function(t,i,s){0!==this.V&&(this.PC=t,this.addBranchCycles(t,i))},CLC:function(t,i,s){this.C=0},CLD:function(t,i,s){this.D=0},CLI:function(t,i,s){this.I=0},CLV:function(t,i,s){this.V=0},compare:function(t,i){this.setZN(t-i),this.C=t>=i?1:0},CMP:function(t,i,s){var e=this.read(t);this.compare(this.A,e)},CPX:function(t,i,s){var e=this.read(t);this.compare(this.X,e)},CPY:function(t,i,s){var e=this.read(t);this.compare(this.Y,e)},DEC:function(t,i,s){var e=this.read(t)-1&255;this.write(t,e),this.setZN(e)},DEX:function(t,i,s){this.X=this.X-1&255,this.setZN(this.X)},DEY:function(t,i,s){this.Y=this.Y-1&255,this.setZN(this.Y)},EOR:function(t,i,s){this.A=this.A^this.read(t),this.setZN(this.A)},INC:function(t,i,s){var e=this.read(t)+1&255;this.write(t,e),this.setZN(e)},INX:function(t,i,s){this.X=this.X+1&255,this.setZN(this.X)},INY:function(t,i,s){this.Y=this.Y+1&255,this.setZN(this.Y)},JMP:function(t,i,s){this.PC=t},JSR:function(t,i,s){this.push16(this.PC-1),this.PC=t},LDA:function(t,i,s){this.A=this.read(t),this.setZN(this.A)},LDX:function(t,i,s){this.X=this.read(t),this.setZN(this.X)},LDY:function(t,i,s){this.Y=this.read(t),this.setZN(this.Y)},LSR:function(t,i,s){if(s===modeAccumulator)this.C=1&this.A,this.A>>=1,this.setZN(this.A);else{var e=this.read(t);this.C=1&e,e>>=1,this.write(t,e),this.setZN(e)}},NOP:function(t,i,s){},ORA:function(t,i,s){this.A=this.A|this.read(t),this.setZN(this.A)},PHA:function(t,i,s){this.push(this.A)},PHP:function(t,i,s){this.push(16|this.flags())},PLA:function(t,i,s){this.A=this.pull(),this.setZN(this.A)},PLP:function(t,i,s){this.setFlags(239&this.pull()|32)},ROL:function(t,i,s){var e=this.C;if(s===modeAccumulator)this.C=this.A>>7&1,this.A=255&(this.A<<1|e),this.setZN(this.A);else{var r=this.read(t);this.C=r>>7&1,r=255&(r<<1|e),this.write(t,r),this.setZN(r)}},ROR:function(t,i,s){var e=this.C;if(s===modeAccumulator)this.C=1&this.A,this.A=255&(this.A>>1|e<<7),this.setZN(this.A);else{var r=this.read(t);this.C=1&r,r=255&(r>>1|e<<7),this.write(t,r),this.setZN(r)}},RTI:function(t,i,s){this.setFlags(239&this.pull()|32),this.PC=this.pull16()},RTS:function(t,i,s){this.PC=this.pull16()+1},SBC:function(t,i,s){var e=this.A,r=this.read(t),n=this.C;this.A=e-r-(1-n)&255,this.setZN(this.A),this.C=e-r-(1-n)>=0?1:0,0!=(128&(e^r))&&0!=(128&(e^this.A))?this.V=1:this.V=0},SEC:function(t,i,s){this.C=1},SED:function(t,i,s){this.D=1},SEI:function(t,i,s){this.I=1},STA:function(t,i,s){this.write(t,this.A)},STX:function(t,i,s){this.write(t,this.X)},STY:function(t,i,s){this.write(t,this.Y)},TAX:function(t,i,s){this.X=this.A,this.setZN(this.X)},TAY:function(t,i,s){this.Y=this.A,this.setZN(this.Y)},TSX:function(t,i,s){this.X=this.SP,this.setZN(this.X)},TXA:function(t,i,s){this.A=this.X,this.setZN(this.A)},TXS:function(t,i,s){this.SP=this.X},TYA:function(t,i,s){this.A=this.Y,this.setZN(this.A)},AHX:function(t,i,s){throw new Error("illegal instruction")},ALR:function(t,i,s){throw new Error("illegal instruction")},ANC:function(t,i,s){throw new Error("illegal instruction")},ARR:function(t,i,s){throw new Error("illegal instruction")},AXS:function(t,i,s){throw new Error("illegal instruction")},DCP:function(t,i,s){throw new Error("illegal instruction")},ISC:function(t,i,s){throw new Error("illegal instruction")},KIL:function(t,i,s){throw new Error("illegal instruction")},LAS:function(t,i,s){throw new Error("illegal instruction")},LAX:function(t,i,s){throw new Error("illegal instruction")},RLA:function(t,i,s){throw new Error("illegal instruction")},RRA:function(t,i,s){throw new Error("illegal instruction")},SAX:function(t,i,s){throw new Error("illegal instruction")},SHX:function(t,i,s){throw new Error("illegal instruction")},SHY:function(t,i,s){throw new Error("illegal instruction")},SLO:function(t,i,s){throw new Error("illegal instruction")},SRE:function(t,i,s){throw new Error("illegal instruction")},TAS:function(t,i,s){throw new Error("illegal instruction")},XAA:function(t,i,s){throw new Error("illegal instruction")}},module.exports=CPU},function(t,i){function s(t,i){for(var s=[];i>0;s[--i]=t);return s.join("")}i.sprintf=function(){for(var t,i,e,r,n,h=0,a=arguments[h++],o=[];a;){if(i=/^[^\x25]+/.exec(a))o.push(i[0]);else if(i=/^\x25{2}/.exec(a))o.push("%");else{if(!(i=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(a)))throw"Huh ?!";if(null==(t=arguments[i[1]||h++])||void 0==t)throw"Too few arguments.";if(/[^s]/.test(i[7])&&"number"!=typeof t)throw"Expecting number but found "+typeof t;switch(i[7]){case"b":t=t.toString(2);break;case"c":t=String.fromCharCode(t);break;case"d":t=parseInt(t);break;case"e":t=i[6]?t.toExponential(i[6]):t.toExponential();break;case"f":t=i[6]?parseFloat(t).toFixed(i[6]):parseFloat(t);break;case"o":t=t.toString(8);break;case"s":t=(t=String(t))&&i[6]?t.substring(0,i[6]):t;break;case"u":t=Math.abs(t);break;case"x":t=t.toString(16);break;case"X":t=t.toString(16).toUpperCase()}t=/[def]/.test(i[7])&&i[2]&&t>=0?"+"+t:t,r=i[3]?"0"==i[3]?"0":i[3].charAt(1):" ",n=i[5]-String(t).length-"".length,e=i[5]?s(r,n):"",o.push(""+(i[4]?t+e:e+t))}a=a.substring(i[0].length)}return o.join("")}},function(t,i){function s(t,i){return i=(i-8192)%4096,8192+1024*e[t][i/1024]+i%1024}var e=[[0,0,1,1],[0,1,0,1],[0,0,0,0],[1,1,1,1],[0,1,2,3]],r=[6710886,10888,1315495,3866788,6029438,7209024,7079424,5643520,3355904,739328,20992,20232,16461,0,0,0,11382189,1400793,4342015,7677950,10492620,12000891,11874592,10046976,7040256,3704576,824064,36658,31885,0,0,0,16776959,6598911,9605375,13006591,15952639,16674508,16679280,15375906,12369408,8968192,6087728,4579458,4771294,5197647,0,0,16776959,12640255,13882111,15255807,16499455,16696554,16698565,16242853,15000980,13627286,12448939,11793356,11922418,12105912,0,0],n=function(t){this.nes=t,this.cycle=0,this.scanLine=0,this.frame=0;var i;for(this.paletteIndex=new Array(32),i=0;i<this.paletteIndex.length;i++)this.paletteIndex[i]=0;for(this.nameTableData=new Array(2048),i=0;i<this.nameTableData.length;i++)this.nameTableData[i]=0;for(this.oamData=new Array(256),i=0;i<this.oamData.length;i++)this.oamData[i]=0;this.v=0,this.t=0,this.x=0,this.w=0,this.f=0,this.reset()};n.prototype={reset:function(){this.cycle=340,this.scanLine=240,this.frame=0,this.writeControl1(0),this.writeControl2(0),this.writeOAMAddress(0)},step:function(){},readImagePalette:function(){for(var t=[],i=0;i<16;i++)t[i]=r[this.readPaletteIndex(i)];return t},readSpritePalette:function(){for(var t=[],i=0;i<16;i++)t[i]=r[this.readPaletteIndex(i+16)];return t},readPaletteIndex:function(t){return this.paletteIndex[t]},writePaletteIndex:function(t,i){this.paletteIndex[t]=i},read:function(t){if(console.warn("ppu read",t.toString(16)),(t%=16384)<8192)return this.nes.mapper.read(t);if(t<16128){var i=this.nes.ines.mirroring;return this.nameTableData[s(i,t)%2048]}if(t<16384)return this.readPaletteIndex(t%32);throw new Error("unhandled ppu memory read at address: "+t.toString(16))},write:function(t,i){if(console.warn("ppu write",t.toString(16),i.toString(16)),t%=16384,t<8192&&this.nes.mapper.write(t,i),t<16128){var e=this.nes.ines.mirroring;return this.nameTableData[s(e,t)%2048]}if(t<16384)return this.writePaletteIndex(t%32,i);throw new Error("unhandled ppu memory write at address: "+t.toString(16))},readRegister:function(t){switch(console.warn("ppu register read",t.toString(16)),t){case 8192:case 8193:throw new Error("invalid ppu register read at address: "+t.toString(16));case 8194:return this.readStatus();case 8195:throw new Error("invalid ppu register read at address: "+t.toString(16));case 8196:return this.readOAMData();case 8197:case 8198:throw new Error("invalid ppu register read at address: "+t.toString(16));case 8199:return this.readData();case 16404:throw new Error("invalid ppu register read at address: "+t.toString(16));default:throw new Error("unhandled ppu register read at address: "+t.toString(16))}},writeRegister:function(t,i){switch(console.warn("ppu register write",t.toString(16),i.toString(16)),t){case 8192:return void this.writeControl1(i);case 8193:return void this.writeControl2(i);case 8194:throw new Error("invalid ppu register write at address: "+t.toString(16));case 8195:return void this.writeOAMAddress(i);case 8196:throw new Error("invalid ppu register write at address: "+t.toString(16));case 8197:return void this.writeScroll(i);case 8198:return void this.writeAddress(i);case 8199:return void this.writeData(i);case 16404:return void this.writeDMA(i);default:throw new Error("unhandled ppu register write at address: "+t.toString(16))}},writeControl1:function(t){t&=15,this.flagNameTable=t>>0&3,this.flagIncrement=t>>2&1,this.flagSpriteTable=t>>3&1,this.flagBackgroundTable=t>>4&1,this.flagSpriteSize=t>>5&1,this.flagMasterSlave=t>>6&1,this.nmiOutput=1==(t>>7&1)},writeControl2:function(t){t&=15,this.flagGrayscale=t>>0&1,this.flagShowLeftBackground=t>>1&1,this.flagShowLeftSprites=t>>2&1,this.flagShowBackground=t>>3&1,this.flagShowSprites=t>>4&1,this.flagRedTint=t>>5&1,this.flagGreenTint=t>>6&1,this.flagBlueTint=t>>7&1},readStatus:function(){var t=31&this.register;return t|=this.flagSpriteOverflow<<5,t|=this.flagSpriteZeroHit<<6,this.nmiOccurred&&(t|=128),this.nmiOccurred=!1,this.w=0,t},writeOAMAddress:function(t){t&=15,this.oamAddress=t},readOAMData:function(){return this.oamData[this.oamAddress]},writeOAMData:function(t){t&=15,this.oamData[this.oamAddress]=t,this.oamAddress++},writeScroll:function(t){t&=255,0===this.w?(this.t=65504&ppu.t|t>>3,this.x=7&t,this.w=1):(this.t=36863&this.t|(7&t)<<12,this.t=64543&this.t|(248&t)<<2,this.w=0)},writeAddress:function(t){0===this.w?(this.t=33023&this.t|(63&t)<<8,this.w=1):(this.t=65280&this.t|t,this.v=this.t,this.w=0)},readData:function(){var t=this.read(this.v);if(this.v%16384<16128){var i=ppu.bufferedData;this.bufferedData=t,t=i}else this.bufferedData=this.read(this.v-4096);return 0===this.flagIncrement?this.v+=1:this.v+=32,t},writeData:function(t){this.write(this.v,t),0===this.flagIncrement?this.v+=1:this.v+=32},writeDMA:function(t){for(var i=this.nes.cpu,s=t<<8,e=0;e<256;e++)this.oamData[ppu.oamAddress]=i.read(s),this.oamAddress++,s++;i.stall+=513,i.cycles%2==1&&i.stall++}},t.exports=n},function(t,i){var s=function(t){this.nes=t,this.rpgRomBanks=this.nes.ines.rpgRom.length,this.rpgRomUpperBank=this.rpgRomBanks-1,this.rpgRomLowerBank=0};s.prototype={read:function(t){if((t&=65535)<8192)return 255&this.nes.ines.chrRom[0][t];if(t>=49152)return 255&this.nes.ines.rpgRom[this.rpgRomUpperBank][t-49152];if(t>=32768)return 255&this.nes.ines.rpgRom[this.rpgRomLowerBank][t-32768];if(t>=24576)return 255&this.nes.ines.sram[t-24576];throw new Error("unhandled mapper2 read at address: "+t.toString(16))},write:function(t,i){if(t&=65535,i&=255,t<8192)return void(this.nes.ines.chrRom[0][t]=i);if(t>=32768)return void(this.rpgRomLowerBank=i%this.rpgRomBanks);if(t>=24576)return void(this.nes.ines.sram[t-24576]=i);throw new Error("unhandled mapper2 write at address: "+t.toString(16))}},t.exports=s}])});